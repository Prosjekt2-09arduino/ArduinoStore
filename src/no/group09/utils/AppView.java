package no.group09.utils;

import no.group09.stk500_v1.STK500v1;
import no.group09.stk500_v1.STK500v1.ProtocolState;
import no.group09.ucsoftwarestore.R;
import no.group09.database.Save;
import no.group09.database.entity.App;
import no.group09.database.entity.BinaryFile;
import no.group09.database.entity.Developer;
import android.app.Activity;
import android.app.ActivityManager;
import android.app.AlertDialog;
import android.app.Dialog;
import android.app.ProgressDialog;
import android.app.ActivityManager.RunningServiceInfo;
import android.os.Bundle;
import android.os.Handler;
import android.preference.PreferenceManager;
import android.util.Log;
import android.view.View;
import android.widget.ImageView;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.RatingBar;
import android.widget.TextView;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.SharedPreferences;

/**
 * The informational view of an app in the shop.
 */
public class AppView extends Activity {

	ProgressDialog progressBar;
	private int progressNumber = 0;
	private Handler progressHandler;
	private Save save;
	private Context ctxt;
	private Thread progressbarThread;
	private ProtocolState state;
	private static final String TAG = "AppView";
	private BtArduinoService service;
	private String message = "";
	private AlertDialog installDialog, resultDialog;
	private byte[] byteArray;
	private AlertDialog.Builder responseDialog;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		//Set the xml layout
		setContentView(R.layout.app_view);	

		ctxt = getBaseContext();

		//Fetch the application ID from the intent
		int appID = getIntent().getExtras().getInt("app");

		//Get the database
		save = new Save(getBaseContext());

		progressBar = new ProgressDialog(this);
		
		responseDialog = new AlertDialog.Builder(this);

		byteArray = testProgrammer();


		//Fetch the application from the database
		App app = save.getAppByID(appID);
		Developer developer = save.getDeveloperByID(app.getDeveloperID());
		BinaryFile binaryfile = save.getBinaryFileByAppID(appID);
		final String blob = binaryfile.getBinaryFileAsString();

		//Get the objects from xml
		TextView appName = (TextView) findViewById(R.id.app_view_app_name);
		TextView appDeveloper = (TextView) findViewById(R.id.app_view_developer);
		RatingBar rating = (RatingBar) findViewById(R.id.ratingBarIndicator);
		TextView appDescription = (TextView) findViewById(R.id.app_view_description);
		ImageView thumb_image = (ImageView) findViewById(R.id.app_profile_pic);

		//Set the information on the UI that we fetched from the database-objects
		appName.setText(app.getName());
		appDeveloper.setText(developer.getName());
		rating.setRating(app.getRating());
		appDescription.setText(app.getDescription());

		if(app.getCategory().equals("Games")){
			thumb_image.setImageResource(R.drawable.games);
		}
		else if(app.getCategory().equals("Medical")){
			thumb_image.setImageResource(R.drawable.medical);
		}

		else if(app.getCategory().equals("Tools")){
			thumb_image.setImageResource(R.drawable.tools);
		}

		else if(app.getCategory().equals("Media")){
			thumb_image.setImageResource(R.drawable.media);
		}

		Button installButton = (Button) findViewById(R.id.button1);
		installButton.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				installClicked(v);
			}
		});
	}

	public byte[] testProgrammer() {
		String hexData =
				//	"3A	10	0000	00	0C9465000C948D000C948D000C948D0064" +
				"3A100000000C9465000C948D000C948D000C948D0064" +
				"3A100010000C948D000C948D000C948D000C94330E78" +
				"3A100020000C948D000C948D000C948D000C948D001C" +
				"3A100030000C948D000C948D000C948D000C948D000C" +
				"3A100040000C94B1090C948D000C948B0B0C94D90B6F" +
				"3A100050000C948D000C948D000C948D000C948D00EC" +
				"3A100060000C948D000C948D000000000024002700EB" +
				"3A100070002A0000000000250028002B0000000000DE" +
				"3A1000800023002600290004040404040404040202DA" +
				"3A100090000202020203030303030301020408102007" +
				"3A1000A0004080010204081020010204081020000012" +
				"3A1000B0000007000201000003040600000000000029" +
				"3A1000C00000000200B602450DAF0211241FBECFEFA3" +
				"3A1000D000D8E0DEBFCDBF12E0A0E0B1E0EAE8F4E294" +
				"3A1000E00002C005900D92A632B107D9F713E0A6E23F" +
				"3A1000F000B2E001C01D92A334B107E1F710E0C8ECF3" +
				"3A10010000D0E004C02297FE010E94FD11C43CD1073B" +
				"3A10011000C9F70E949B0D0C9438120C940000CF93E9" +
				"3A10012000DF93BC018230910510F462E070E0A09191" +
				"3A100130004103B0914203ED01E0E0F0E040E050E027" +
				"3A1001400021C0888199818617970769F48A819B81EC" +
				"3A10015000309719F09383828304C090934203809375" +
				"3A100160004103FE0134C06817790738F44115510581" +
				"3A1001700019F08417950708F4AC01FE018A819B8170" +
				"3A100180009C01E9012097E9F641155105A9F1CA0141" +
				"3A10019000861B970B049708F4BA01E0E0F0E02AC050" +
				"3A1001A0008D919C91119784179507F9F46417750741" +
				"3A1001B00081F412968D919C911397309719F0938347" +
				"3A1001C000828304C09093420380934103FD013296E1" +
				"3A1001D0004CC0CA01861B970BFD01E80FF91F619304" +
				"3A1001E000719302978D939C9340C0FD01828193810E" +
				"3A1001F0009C01D9011097A1F680913F039091400393" +
				"3A10020000892B41F480910102909102029093400366" +
				"3A1002100080933F0340910302509104024115510520" +
				"3A1002200041F44DB75EB78091FF0190910002481BE9" +
				"3A10023000590B20913F0330914003CA01821B930B5D" +
				"3A100240008617970780F0AB014E5F5F4F84179507C5" +
				"3A1002500050F0420F531F5093400340933F03F90166" +
				"3A100260006193719302C0E0E0F0E0CF01DF91CF91A4" +
				"3A100270000895CF93DF93009709F450C0EC012297C3" +
				"3A100280001B821A82A0914103B0914203109709F199" +
				"3A1002900040E050E0AC17BD0708F1BB83AA83FE0124" +
				"3A1002A00021913191E20FF31FAE17BF0779F48D91C1" +
				"3A1002B0009C911197280F391F2E5F3F4F3983288358" +
				"3A1002C00012968D919C9113979B838A8341155105BA" +
				"3A1002D00071F4D0934203C093410320C012968D91D4" +
				"3A1002E0009C911397AD01009711F0DC01D3CFFA0177" +
				"3A1002F000D383C28321913191E20FF31FCE17DF0721" +
				"3A1003000069F488819981280F391F2E5F3F4FFA01C8" +
				"3A10031000318320838A819B8193838283DF91CF9174" +
				"3A100320000895A0E0B0E0E7E9F1E00C9403126C015D" +
				"3A10033000009729F4CB010E948F006C01C1C08EEFA1" +
				"3A10034000882E8FEF982E8C0C9D1C8601060F171F90" +
				"3A100350000815190508F4B2C0F401A081B181A617EF" +
				"3A10036000B707B8F0A530B10508F4AAC0CD010497CD" +
				"3A100370008617970708F4A4C01297A61BB70BF801BD" +
				"3A10038000A193B193D4016D937C93CF010E94390165" +
				"3A1003900097C07B01EA1AFB0AEEEFFFEFEE0EFF1E9D" +
				"3A1003A00036016A0E7B1EC0914103D0914203442462" +
				"3A1003B0005524AA24BB244AC0C615D705E1F54881B7" +
				"3A1003C00059814E155F05B8F1CA0104978E159F0536" +
				"3A1003D000B0F41296A40FB51FF401B183A0832A8153" +
				"3A1003E0003B814114510431F0D20113963C932E937A" +
				"3A1003F000129766C0309342032093410361C08A8103" +
				"3A100400009B81F80193838283425050404E195F09CB" +
				"3A10041000518340834114510431F0D20113961C934F" +
				"3A100420000E93129704C01093420300934103F4010A" +
				"3A100430007183608345C088819981A816B90608F444" +
				"3A100440005C012E018A819B819C01E901209709F0C2" +
				"3A10045000B3CF80913F039091400386159705E9F44F" +
				"3A10046000A616B706D0F4209103023091040221159C" +
				"3A10047000310541F42DB73EB78091FF019091000204" +
				"3A10048000281B390B02171307C8F41093400300937D" +
				"3A100490003F03D4016D937C9313C0CB010E948F0066" +
				"3A1004A000EC01009759F0F40140815181B6010E949E" +
				"3A1004B0006602C6010E9439016E0102C0CC24DD240F" +
				"3A1004C000C601CDB7DEB7E0E10C941F12FB01DC01E1" +
				"3A1004D00002C001900D9241505040D8F70895FB01A1" +
				"3A1004E000DC0101900D920020E1F708950895089530" +
				"3A1004F000CF92EF920F9381309105C1F46F5F7F4FE0" +
				"3A1005000051F586E292E040E050E060E070E00E9449" +
				"3A10051000880784E592E067E048E029E00AE05BE0D4" +
				"3A10052000E52E3CE0C32E0E94780915C0892B99F472" +
				"3A100530006F5F7F4F81F48DE492E00E94991186E411" +
				"3A1005400092E00E9499118FE392E00E94991188E352" +
				"3A1005500092E00E9499110F91EF90CF90089580E062" +
				"3A1005600090E06FEF7FEF0E947802089581E090E0C5" +
				"3A100570006FEF7FEF0E947802089586E292E00E947A" +
				"3A10058000F7050895EF92FF920F931F93DF93CF9398" +
				"3A10059000CDB7DEB72E970FB6F894DEBF0FBECDBF36" +
				"3A1005A00066E2E62E62E0F62EC70140E052EC61E022" +
				"3A1005B00070E00E946E0784E061E00E94A50A84E07A" +
				"3A1005C00061E00E94E40A8E010F5F1F4FC80160E0E6" +
				"3A1005D00071E00E946811C701B8010E946A07C80152" +
				"3A1005E0000E9499118E01085F1F4FC80165E071E0FC" +
				"3A1005F0000E946811C701B8010E946607C8010E94E5" +
				"3A10060000991100E111E0C7016BE071E0A8010E94BF" +
				"3A100610002E07C70163E043E753E00E941D04C701B2" +
				"3A1006200061E171E0A8010E942E07C7016FEF46E764" +
				"3A1006300052E00E941D04C70167E171E04FE151E003" +
				"3A100640000E942E07C70167E049E953E00E941D049C" +
				"3A10065000C70161E271E0A8010E942E07C70161E0B5" +
				"3A1006600049ED53E00E941D0404E512E0C80160E179" +
				"3A1006700042E020E00E94C208C80160E040E00E9421" +
				"3A100680008308C8016CE271E00E94F80DC80160E0C7" +
				"3A1006900041E00E948308C8016AE371E00E94F80DFE" +
				"3A1006A000C70166E471E04FE451E00E942E0782E04A" +
				"3A1006B00061E00E94A50A8DE061E00E94A50AC701E1" +
				"3A1006C00064E571E046E851E00E94F6062E960FB60A" +
				"3A1006D000F894DEBF0FBECDBFCF91DF911F910F9178" +
				"3A1006E000FF90EF9008950F931F93CF93DF93C0E097" +
				"3A1006F000D0E0082F10E015C08DE061E00E94E40A10" +
				"3A1007000064E670E080E090E00E94070A8DE060E01F" +
				"3A100710000E94E40A64E670E080E090E00E94070A2C" +
				"3A100720002196C017D10744F3DF91CF911F910F910C" +
				"3A10073000089583E068EC70E020E030E040E050E0B5" +
				"3A100740000E948F0E64E670E080E090E00E94070A4D" +
				"3A1007500083E068E572E020E030E040E050E00E9495" +
				"3A100760008F0E64E670E080E090E00E94070A83E06C" +
				"3A1007700066E475E020E030E040E050E00E948F0E3B" +
				"3A1007800068EC70E080E090E00E94070A83E068EC8B" +
				"3A1007900070E020E030E040E050E00E948F0E64E620" +
				"3A1007A00070E080E090E00E94070A83E00E941C0E47" +
				"3A1007B0000895CF92DF92EF92FF921F93CF93DF9332" +
				"3A1007C0006B017A0184E592E00E94BA0884E592E028" +
				"3A1007D0000E94B20810E0C0E0D0E021C0F601EC0FAA" +
				"3A1007E000FD1F60816A3039F484E592E060E041E009" +
				"3A1007F0000E94830812C084E592E00E94D40D112368" +
				"3A1008000049F4CF30D10554F084E592E060E041E056" +
				"3A100810000E948308CF31D1052CF411E02196CE152A" +
				"3A10082000DF05E0F2DF91CF911F91FF90EF90DF9015" +
				"3A10083000CF90089580E090E00895E62FF0E03196A3" +
				"3A10084000EE0FFF1FE80FF91F51834083089584E0E6" +
				"3A1008500060E00E94E40A0895CF92DF92EF92FF9247" +
				"3A100860001F93CF93DF93162F6A01790187E093E0FE" +
				"3A100870006FEF0E94050D87E093E06F2D0E94050D3C" +
				"3A1008800087E093E06E2D0E94050D87E093E06EEF08" +
				"3A100890000E94050D87E093E0612F0E94050DC0E0E6" +
				"3A1008A000D0E009C0F601EC0FFD1F87E093E0608106" +
				"3A1008B0000E94050D2196CE15DF05A0F3DF91CF91A3" +
				"3A1008C0001F91FF90EF90DF90CF9008950F931F93AB" +
				"3A1008D000CF93DF93EC01062F142F862F61E00E9447" +
				"3A1008E000A50A60E0111161E0802F0E94E40ACE01A8" +
				"3A1008F00065E040E050E020E030E00E942C04DF9111" +
				"3A10090000CF911F910F910895EF92FF921F93DF9364" +
				"3A10091000CF930F92CDB7DEB77C01162F862F60E004" +
				"3A100920000E94A50A812F0E94380B198218161906F9" +
				"3A1009300014F481E08983C70164E0AE014F5F5F4F2B" +
				"3A1009400021E030E00E942C040F90CF91DF911F91A5" +
				"3A10095000FF90EF9008950F931F93CF93DF938C0137" +
				"3A10096000DB01842FE801E885F985B901AD0109951E" +
				"3A10097000C80163E040E050E020E030E00E942C0439" +
				"3A10098000DF91CF911F910F910895CF92DF92EF9257" +
				"3A10099000FF920F931F93DF93CF9300D0CDB7DEB7B5" +
				"3A1009A0006C01862FD6011696ED91FC9117977E016A" +
				"3A1009B0000894E11CF11CB70140E050E009958C015E" +
				"3A1009C000FC019081818189839A83C60162E0A7013D" +
				"3A1009D00022E030E00E942C04C8010E9439010F90EF" +
				"3A1009E0000F90CF91DF911F910F91FF90EF90DF90CB" +
				"3A1009F000CF9008950F931F93CF93DF938C01DB016A" +
				"3A100A0000842FE801EC81FD81B901AD010995C80190" +
				"3A100A100061E040E050E020E030E00E942C04DF91F3" +
				"3A100A2000CF911F910F91089560E040E050E020E0E9" +
				"3A100A300030E00E942C040895CF92DF92EF92FF9253" +
				"3A100A40000F931F93DF93CF93CDB7DEB727970FB6E2" +
				"3A100A5000F894DEBF0FBECDBF7C018E010F5F1F4F2C" +
				"3A100A6000C8016DE971E00E946811C8016EE971E08A" +
				"3A100A70000E941D1182E190E0E80EF91EC801B70145" +
				"3A100A80000E942D11C80168EA71E00E941D11C80181" +
				"3A100A90006BEA71E00E941D1187E090E0E80EF91EFC" +
				"3A100AA000C801B7010E942D11C80168EA71E00E94D7" +
				"3A100AB0001D11C80167EB71E00E941D1187E090E0F5" +
				"3A100AC000E80EF91EC801B7010E942D11C80165EC9E" +
				"3A100AD00071E00E941D11C80168EC71E00E941D11B7" +
				"3A100AE00087E090E0E80EF91EC801B7010E942D11C1" +
				"3A100AF000C80163ED71E00E941D11CD80DE8087E0AA" +
				"3A100B000093E06FEF0E94050D87E093E06D2D0E944A" +
				"3A100B1000050D87E093E06C2D0E94050D87E093E0C2" +
				"3A100B20006EEF0E94050D87E093E066E00E94050DE0" +
				"3A100B3000EE24FF2410C0C801B7010E94A510FC01DB" +
				"3A100B40006081772767FD709587E093E00E94050D2F" +
				"3A100B50000894E11CF11CEC14FD0468F3C8010E9428" +
				"3A100B6000991127960FB6F894DEBF0FBECDBFCF9177" +
				"3A100B7000DF911F910F91FF90EF90DF90CF9008953C" +
				"3A100B80000F931F93F8014330E1F0443028F44130D3" +
				"3A100B900079F0423090F409C04530E1F04530B0F0D2" +
				"3A100BA0004630E9F04F3F01F51DC00E9414051CC0FE" +
				"3A100BB000422F98010E94FA0417C0622F0E94C504B8" +
				"3A100BC00013C0422F98010E94AB040EC0622F0E94F6" +
				"3A100BD00084040AC0622F40810E94660405C00E94FE" +
				"3A100BE0001C0502C00E9427041F910F9108956F9267" +
				"3A100BF0007F928F929F92AF92BF92CF92DF92EF92AD" +
				"3A100C0000FF920F931F93CF93DF93EC010E94F9099A" +
				"3A100C100020917002309171024091720250917302E2" +
				"3A100C2000261737074807590750F4809174029091AE" +
				"3A100C30007502892B21F010927502109274020E94A5" +
				"3A100C4000F9096053784F8F4F9F4F609370027093F4" +
				"3A100C50007102809372029093730273E0672E712C7D" +
				"3A100C600065E0862E912C54E0A52EB12C41E0C42ED7" +
				"3A100C7000D12C32E0E32EF12CA3C08091740290912C" +
				"3A100C8000750282309105C1F18330910534F40097EB" +
				"3A100C900081F0019709F08FC022C08430910509F4DA" +
				"3A100CA00053C0843091050CF444C0059709F083C00B" +
				"3A100CB00056C087E093E00E94CC0C8F3F910509F06D" +
				"3A100CC0007AC0D0927502C092740280916A029091AB" +
				"3A100CD0006B02009709F46FC00E9439016CC087E075" +
				"3A100CE00093E00E94CC0C10926E0280936F02F092FF" +
				"3A100CF0007502E09274025FC000916E0210916F0263" +
				"3A100D000087E093E00E94CC0C90E0802B912B909395" +
				"3A100D10006F0280936E0270927502609274020E945C" +
				"3A100D20008F0090936B0280936A02009709F043C092" +
				"3A100D30003EC087E093E00E94CC0C80936D02B0929D" +
				"3A100D40007502A092740237C087E093E00E94CC0C39" +
				"3A100D500080936C0290927502809274022CC08091F4" +
				"3A100D6000690200916A0210916B02080F111D87E061" +
				"3A100D700093E00E94CC0CF8018083809169028F5F20" +
				"3A100D80008093690260916E0270916F0290E0861705" +
				"3A100D9000970788F000916A0210916B02CE01409192" +
				"3A100DA0006D0220916C020E94C0051092690210929F" +
				"3A100DB00075021092740288819981019699838883C3" +
				"3A100DC00087E093E00E949B0C892B09F056CFDF91BE" +
				"3A100DD000CF911F910F91FF90EF90DF90CF90BF9038" +
				"3A100DE000AF909F908F907F906F900895CF92DF92F9" +
				"3A100DF000EF92FF920F931F93CF93DF93EC016B0160" +
				"3A100E00007A018BA59CA5892B31F0CE01879666EDE2" +
				"3A100E100071E00E941D118E01095D1F4FC8016EE92E" +
				"3A100E200071E00E941D11C801B7010E941D11C80187" +
				"3A100E300069ED71E00E941D11C801B6010E941D11EB" +
				"3A100E4000C80165EE71E00E941D11DF91CF911F91E5" +
				"3A100E50000F91FF90EF90DF90CF900895CF92DF92A7" +
				"3A100E6000EF92FF920F931F93CF93DF93EC017B01DF" +
				"3A100E70006A018CA19DA1892B31F0CE01809666ED8F" +
				"3A100E800071E00E941D118E01005E1F4FC80168EEC7" +
				"3A100E900071E00E941D11C801B7010E941D11C80117" +
				"3A100EA00062EF71E00E941D11C801B6010E941D1180" +
				"3A100EB000C80165EE71E00E941D11DF91CF911F9175" +
				"3A100EC0000F91FF90EF90DF90CF90089549960E9488" +
				"3A100ED0008211089542960E94821108950F931F93E4" +
				"3A100EE000182F092F87E093E00E94140C212F302F38" +
				"3A100EF000C901FC0180E090E02AE134E033832283E1" +
				"3A100F00000196329688309105C9F71F910F91089587" +
				"3A100F1000EF92FF920F931F93CF93DF93EC017A012F" +
				"3A100F20008B0142966DE971E00E946811CE014996ED" +
				"3A100F30006DE971E00E946811CE0180966DE971E063" +
				"3A100F40000E946811CE0187966DE971E00E946811D8" +
				"3A100F5000E114F1040105110529F0CE01B801A70142" +
				"3A100F60000E946E07DF91CF911F910F91FF90EF903C" +
				"3A100F700008950F931F938C01FC01868160E00E940D" +
				"3A100F8000E40A81E090E00E94600AF801868161E055" +
				"3A100F90000E94E40A81E090E00E94600AF8018681E4" +
				"3A100FA00060E00E94E40A84E690E00E94600A1F91DB" +
				"3A100FB0000F910895CF92DF92EF92FF920F931F93BC" +
				"3A100FC000CF93DF93D82EC92E282F392FC9018C013A" +
				"3A100FD000C0E0D0E0E62EFF24F801878161E00E94A6" +
				"3A100FE000A50AB7010C2E02C0759567950A94E2F721" +
				"3A100FF0006170F80187810E94E40A21960F5F1F4FFC" +
				"3A10100000C830D10549F78D2D9C2D0E94B907DF917D" +
				"3A10101000CF911F910F91FF90EF90DF90CF900895A7" +
				"3A10102000CF92DF92EF92FF920F931F93CF93DF93B4" +
				"3A10103000D82EC92E282F392FC9018C01C0E0D0E04D" +
				"3A10104000E62EFF24F801878161E00E94A50AB7011E" +
				"3A101050000C2E02C0759567950A94E2F76170F8014D" +
				"3A1010600087810E94E40A21960F5F1F4FC430D1058B" +
				"3A1010700049F78D2D9C2D0E94B907DF91CF911F91CB" +
				"3A101080000F91FF90EF90DF90CF9008951F93CF9333" +
				"3A10109000DF93EC01162F8C81642F0E94E40A8D816E" +
				"3A1010A0008F3F19F060E00E94E40A8F8584FF05C03D" +
				"3A1010B000CE01612F0E94DA070EC0612F70E084E03C" +
				"3A1010C000759567958A95E1F7CE010E941008CE01CB" +
				"3A1010D000612F0E941008DF91CF911F91089541E088" +
				"3A1010E0000E94460881E090E0089540E00E94460892" +
				"3A1010F0000895FC016089862F8460808B6C60CF012D" +
				"3A101100000E9475080895DF93CF93CDB7DEB7289777" +
				"3A101110000FB6F894DEBF0FBECDBF9C01FE01319625" +
				"3A10112000AEE0B2E088E00D9001928150E1F7F90164" +
				"3A101130008389481710F0482F4150E42FF0E0EE0F5C" +
				"3A10114000FF1FEC0FFD1F8181680F6068C9010E94BD" +
				"3A10115000750828960FB6F894DEBF0FBECDBFCF91AD" +
				"3A10116000DF91089562E00E94750880ED97E00E948B" +
				"3A10117000600A089561E00E94750880ED97E00E9482" +
				"3A10118000600A0895CF93DF93EC01423018F08F8509" +
				"3A1011900088608F874B8B1C8A222329F0413019F4F9" +
				"3A1011A0008F8584608F8780E593EC0E94600A8C8134" +
				"3A1011B00060E00E94E40A8E8160E00E94E40A8D8172" +
				"3A1011C0008F3F19F060E00E94E40A6F8564FD1DC046" +
				"3A1011D000CE0163E00E94100884E991E10E94600A58" +
				"3A1011E000CE0163E00E94100884E991E10E94600A48" +
				"3A1011F000CE0163E00E94100886E990E00E94600A38" +
				"3A10120000CE0162E00E94100816C06062CE010E940A" +
				"3A10121000750884E991E10E94600A6F856062CE01E1" +
				"3A101220000E94750886E990E00E94600A6F856062FE" +
				"3A10123000CE010E9475086F856062CE010E9475081C" +
				"3A1012400084E0888BCE010E947908CE010E94BA0802" +
				"3A1012500082E0898BCE0166E00E947508DF91CF9114" +
				"3A1012600008956F927F928F92AF92CF92EF920F93E9" +
				"3A101270001F93DF93CF93CDB7DEB73C01162F842F9A" +
				"3A10128000F301448325830683E782C086A186828694" +
				"3A101290009D8593879E8594879F8595879889968756" +
				"3A1012A00061E00E94A50AF30185818F3F19F061E09A" +
				"3A1012B0000E94A50AF301868161E00E94A50A11231C" +
				"3A1012C00019F0F301178603C080E1F3018787C3019A" +
				"3A1012D00060E141E020E00E94C208CF91DF911F91C0" +
				"3A1012E0000F91EF90CF90AF908F907F906F90089577" +
				"3A1012F0008F92AF92CF92EF920F931F93CF93DF9382" +
				"3A10130000DC01362F542F722F102FAE2C8C2C1396FD" +
				"3A101310001C921E9212978AE092E011969C938E93F3" +
				"3A1013200000D000D0EDB7FEB73196CDB7DEB7198249" +
				"3A10133000118212821382CD0161E0432F2FEF052F1E" +
				"3A10134000E72EC12E0E9431090F900F900F900F9041" +
				"3A10135000DF91CF911F910F91EF90CF90AF908F9031" +
				"3A1013600008951F920F920FB60F9211242F933F935F" +
				"3A101370008F939F93AF93BF9380917A0290917B025A" +
				"3A10138000A0917C02B0917D0230917E020196A11D58" +
				"3A10139000B11D232F2D5F2D3720F02D570196A11D54" +
				"3A1013A000B11D20937E0280937A0290937B02A093DA" +
				"3A1013B0007C02B0937D028091760290917702A09199" +
				"3A1013C0007802B09179020196A11DB11D8093760239" +
				"3A1013D00090937702A0937802B0937902BF91AF9176" +
				"3A1013E0009F918F913F912F910F900FBE0F901F9063" +
				"3A1013F00018958FB7F89420917A0230917B02409132" +
				"3A101400007C0250917D028FBFB901CA0108959B01F2" +
				"3A10141000AC017FB7F8948091760290917702A09109" +
				"3A101420007802B091790266B5A89B05C06F3F19F0AC" +
				"3A101430000196A11DB11D7FBFBA2FA92F982F882714" +
				"3A10144000860F911DA11DB11D62E0880F991FAA1F73" +
				"3A10145000BB1F6A95D1F7BC012DC0FFB7F8948091EE" +
				"3A10146000760290917702A0917802B0917902E6B568" +
				"3A10147000A89B05C0EF3F19F00196A11DB11DFFBF4C" +
				"3A10148000BA2FA92F982F88278E0F911DA11DB11D4E" +
				"3A10149000E2E0880F991FAA1FBB1FEA95D1F7861BB0" +
				"3A1014A000970B885E9340C8F2215030404040504036" +
				"3A1014B00068517C4F211531054105510571F608959C" +
				"3A1014C000019739F0880F991F880F991F029701978C" +
				"3A1014D000F1F70895789484B5826084BD84B5816005" +
				"3A1014E00084BD85B5826085BD85B5816085BDEEE62C" +
				"3A1014F000F0E0808181608083E1E8F0E0108280810B" +
				"3A1015000082608083808181608083E0E8F0E0808178" +
				"3A1015100081608083E1EBF0E0808184608083E0EB98" +
				"3A10152000F0E0808181608083EAE7F0E08081846080" +
				"3A1015300080838081826080838081816080838081DC" +
				"3A10154000806880831092C1000895CF93DF93482F65" +
				"3A1015500050E0CA0186569F4FFC0134914A575F4FB5" +
				"3A10156000FA018491882369F190E0880F991FFC01AA" +
				"3A10157000E859FF4FA591B491FC01EE58FF4FC5917A" +
				"3A10158000D491662351F42FB7F8948C91932F9095B2" +
				"3A1015900089238C93888189230BC0623061F42FB733" +
				"3A1015A000F8948C91932F909589238C938881832B29" +
				"3A1015B00088832FBF06C09FB7F8948C91832B8C93A0" +
				"3A1015C0009FBFDF91CF910895482F50E0CA01825507" +
				"3A1015D0009F4FFC012491CA0186569F4FFC019491B4" +
				"3A1015E0004A575F4FFA013491332309F440C0222354" +
				"3A1015F00051F1233071F0243028F42130A1F0223051" +
				"3A1016000011F514C02630B1F02730C1F02430D9F4E0" +
				"3A1016100004C0809180008F7703C0809180008F7D0F" +
				"3A101620008093800010C084B58F7702C084B58F7D11" +
				"3A1016300084BD09C08091B0008F7703C08091B00055" +
				"3A101640008F7D8093B000E32FF0E0EE0FFF1FEE5888" +
				"3A10165000FF4FA591B4912FB7F894662321F48C9194" +
				"3A101660009095892302C08C91892B8C932FBF08956C" +
				"3A10167000682F70E0CB0182559F4FFC012491CB0174" +
				"3A1016800086569F4FFC0144916A577F4FFB0194910E" +
				"3A10169000992319F420E030E03CC0222351F123309B" +
				"3A1016A00071F0243028F42130A1F0223011F514C05B" +
				"3A1016B0002630B1F02730C1F02430D9F404C0809135" +
				"3A1016C00080008F7703C0809180008F7D80938000A1" +
				"3A1016D00010C084B58F7702C084B58F7D84BD09C0EA" +
				"3A1016E0008091B0008F7703C08091B0008F7D809390" +
				"3A1016F000B000892F90E0880F991F84589F4FFC01FC" +
				"3A10170000A591B4918C9120E030E0842311F021E088" +
				"3A1017100030E0C90108951F920F920FB60F92112465" +
				"3A101720002F933F934F938F939F93EF93FF938091CA" +
				"3A10173000C00082FD1DC04091C6002091BF023091C3" +
				"3A10174000C0022F5F3F4F2F7330708091C102909184" +
				"3A10175000C2022817390771F0E091BF02F091C00270" +
				"3A10176000E158FD4F40833093C0022093BF0202C076" +
				"3A101770008091C600FF91EF919F918F914F913F9182" +
				"3A101780002F910F900FBE0F901F901895E0911303AB" +
				"3A10179000F0911403E05CFF4F8191919120813181A0" +
				"3A1017A000821B930B8F739070892B11F00E94BD02E6" +
				"3A1017B00008951F920F920FB60F9211242F933F930B" +
				"3A1017C0008F939F93EF93FF93209103033091040332" +
				"3A1017D00080910503909106032817390731F4809111" +
				"3A1017E000C1008F7D8093C10014C0E0910503F0918A" +
				"3A1017F0000603ED53FD4F2081809105039091060370" +
				"3A1018000001968F7390709093060380930503209345" +
				"3A10181000C600FF91EF919F918F913F912F910F9073" +
				"3A101820000FBE0F901F901895AF92BF92DF92EF926C" +
				"3A10183000FF920F931F93CF93DF93EC017A018B01FB" +
				"3A10184000DD24403081EE580780E0680780E07807AB" +
				"3A1018500011F0DD24D39491E0A92EB12CEC89FD89FF" +
				"3A10186000DD2069F0C50108A002C0880F991F0A9405" +
				"3A10187000E2F7808360E079E08DE390E005C01082BC" +
				"3A1018800060E874E88EE190E0A80197010E94BE1123" +
				"3A101890002150304040405040569547953795279508" +
				"3A1018A00080E12030380720F0DD2011F0DD24D6CF94" +
				"3A1018B000E889F9893083EA89FB89208319A2EE89B6" +
				"3A1018C000FF89408121E030E0C9010C8C02C0880F03" +
				"3A1018D000991F0A94E2F7482B4083EE89FF894081E3" +
				"3A1018E000C9010D8C02C0880F991F0A94E2F7482B9A" +
				"3A1018F0004083EE89FF894081C9010E8C02C0880FA8" +
				"3A10190000991F0A94E2F7482B4083EE89FF89808172" +
				"3A101910000F8C02C0220F331F0A94E2F72095282370" +
				"3A101920002083DF91CF911F910F91FF90EF90DF9077" +
				"3A10193000BF90AF900895DC011C96ED91FC911D972E" +
				"3A10194000E05CFF4F2191319180819181281B390BFF" +
				"3A101950002F733070C9010895DC011C96ED91FC9144" +
				"3A101960001D97E05CFF4F20813181E054F040DF01A2" +
				"3A10197000AE5BBF4F8D919C9111972817390719F4D1" +
				"3A101980002FEF3FEF07C08D919C91E80FF91F8081E9" +
				"3A10199000282F30E0C9010895DC011C96ED91FC91DF" +
				"3A1019A0001D97E05CFF4F20813181E054F040DF0162" +
				"3A1019B000AE5BBF4F8D919C9111972817390719F491" +
				"3A1019C0002FEF3FEF10C08D919C911197E80FF91FF9" +
				"3A1019D00020818D919C91119701968F739070119633" +
				"3A1019E0009C938E9330E0C9010895DC0191968C910F" +
				"3A1019F0009197882339F05496ED91FC915597808109" +
				"3A101A000086FFF9CF91961C920895CF93DF93EC0156" +
				"3A101A1000EE85FF85E05CFF4F20813181E054F0408E" +
				"3A101A20002F5F3F4F2F733070DF01AE5BBF4F8D9143" +
				"3A101A30009C91119728173907D1F3E05CFF4F808103" +
				"3A101A40009181E054F040E80FF91F6083EE85FF8537" +
				"3A101A5000E05CFF4F31832083EE89FF89208181E0A4" +
				"3A101A600090E00F8C02C0880F991F0A94E2F7282B90" +
				"3A101A7000208381E089A3EC89FD8980818064808353" +
				"3A101A800081E090E0DF91CF91089510920A031092C7" +
				"3A101A9000090388EE93E0A0E0B0E080930B039093FD" +
				"3A101AA0000C03A0930D03B0930E038AE192E0909390" +
				"3A101AB0000803809307038FE792E0909314038093C9" +
				"3A101AC000130383EC92E0909316038093150385EC47" +
				"3A101AD00090E0909318038093170384EC90E0909328" +
				"3A101AE0001A038093190380EC90E090931C03809379" +
				"3A101AF0001B0381EC90E090931E0380931D0382EC06" +
				"3A101B000090E09093200380931F0386EC90E09093E5" +
				"3A101B100022038093210384E08093230383E0809356" +
				"3A101B2000240387E08093250385E08093260381E0EA" +
				"3A101B3000809327030895CF93DF930E946A0A0E943F" +
				"3A101B4000C202C6ECDBE00E9477022097E1F30E941C" +
				"3A101B5000C60BF9CFCF92DF92EF92FF920F931F93B4" +
				"3A101B6000CF93DF937C016B018A01C0E0D0E00FC00E" +
				"3A101B7000D6016D916D01D701ED91FC910190F0813D" +
				"3A101B8000E02DC7010995C80FD91F0150104001155C" +
				"3A101B9000110571F7CE01DF91CF911F910F91FF9049" +
				"3A101BA000EF90DF90CF900895DC01ED91FC910190D2" +
				"3A101BB000F081E02D09950895CF93DF93EC01611535" +
				"3A101BC000710519F420E030E00FC0DB010D9000201A" +
				"3A101BD000E9F71197A61BB70BE881F9810280F38121" +
				"3A101BE000E02DAD0109959C01C901DF91CF910895C8" +
				"3A101BF0000E94DC0D0895813041F0813018F0823070" +
				"3A101C0000D1F409C010926E00089580916F008D7F0D" +
				"3A101C100080936F000895809170008D7F8093700095" +
				"3A101C200081E08093B0008091B100887F84608093D0" +
				"3A101C3000B1001092B30008951F93182F80910502F0" +
				"3A101C4000811711F09FEF06C0E2ECF0E094918FEF66" +
				"3A101C500080930502892F0E94FB0D812F60E00E9476" +
				"3A101C6000E40A1F9108951F920F920FB60F9211244C" +
				"3A101C70002F933F934F935F936F937F938F939F9394" +
				"3A101C8000AF93BF93EF93FF93809137039091380305" +
				"3A101C9000A0913903B0913A030097A105B10551F124" +
				"3A101CA000E0913B03F0913C03808190913D038927B3" +
				"3A101CB00080838091370390913803A0913903B091CC" +
				"3A101CC0003A03181619061A061B06C4F48091370346" +
				"3A101CD00090913803A0913903B0913A030197A1097B" +
				"3A101CE000B1098093370390933803A0933903B093DD" +
				"3A101CF0003A0304C0809105020E941C0EFF91EF91EF" +
				"3A101D0000BF91AF919F918F917F916F915F914F9113" +
				"3A101D10003F912F910F900FBE0F901F9018952F920B" +
				"3A101D20003F925F926F927F928F929F92AF92BF92FB" +
				"3A101D3000CF92DF92EF92FF920F931F93DF93CF9397" +
				"3A101D400000D000D0CDB7DEB7A82F1B0129833A837E" +
				"3A101D50004B835C83809105028A1721F4E2ECF0E06A" +
				"3A101D6000549082C08F3F09F0DAC1A0930502E2ECE3" +
				"3A101D7000F0E054902FEF521609F4D1C181E05816CB" +
				"3A101D800039F192E0591609F449C0552009F06CC0A8" +
				"3A101D900014BC15BC84B5826084BD85B5816085BDE9" +
				"3A101DA0002A2F30E0F901EA57FF4FE491F0E0EE0FFF" +
				"3A101DB000FF1FEE58FF4F8591949190932E038093CF" +
				"3A101DC0002D0326563F4FF901849180932F034EC077" +
				"3A101DD0001092800010928100809181008860809331" +
				"3A101DE0008100809181008160809381002A2F30E002" +
				"3A101DF000F901EA57FF4FE491F0E0EE0FFF1FEE58B4" +
				"3A101E0000FF4F859194919093350380933403265628" +
				"3A101E10003F4FF90184918093360328C01092B0009F" +
				"3A101E20001092B1008091B00082608093B0008091E8" +
				"3A101E3000B10081608093B1002A2F30E0F901EA57A8" +
				"3A101E4000FF4FE491F0E0EE0FFF1FEE58FF4F85913A" +
				"3A101E5000949190933C0380933B0326563F4FF901A6" +
				"3A101E6000849180933D0302C057FC59C18A2F61E0E1" +
				"3A101E70000E94A50A552021F0F2E05F1609F0BEC0CD" +
				"3A101E800031018824992460E072E18AE790E0A4019E" +
				"3A101E900093010E94E01159016A01860175010894BD" +
				"3A101EA000E108F108010911092FEFE216F10401051B" +
				"3A101EB000110509F008F499C060E472E48FE090E045" +
				"3A101EC000A40193010E94E01179018A010894E108BC" +
				"3A101ED000F1080109110982E05816C1F49FEFE916D3" +
				"3A101EE000F1040105110509F008F484C060E970ED02" +
				"3A101EF00083E090E0A40193010E94E01179018A013E" +
				"3A101F00000894E108F1080109110983E0AFEFEA162E" +
				"3A101F1000F1040105110509F008F468C068E478EEE1" +
				"3A101F200081E090E0A40193010E94E01179018A010F" +
				"3A101F30000894E108F10801091109552011F483E022" +
				"3A101F40001DC0B2E05B1611F084E018C0EFEFEE1692" +
				"3A101F5000F1040105110509F008F4DFC064E274EF33" +
				"3A101F600080E090E0A40193010E94E01179018A01D0" +
				"3A101F70000894E108F1080109110985E0FFEFEF1667" +
				"3A101F8000F1040105110591F188F162E17AE780E041" +
				"3A101F900090E0A40193010E94E01179018A01089464" +
				"3A101FA000E108F10801091109552011F086E001C08E" +
				"3A101FB00084E02FEFE216F10401051105B9F0B0F04D" +
				"3A101FC000C601B50120E034E040E050E00E94E0119D" +
				"3A101FD00079018A010894E108F108010911095520E5" +
				"3A101FE00011F087E008C085E003C081E0552019F4B6" +
				"3A101FF00085BD3AC082E08093B10036C05101CC2447" +
				"3A10200000DD2460E072E18AE790E0A60195010E947C" +
				"3A10201000E01179018A010894E108F1080109110928" +
				"3A1020200080E0E81680E0F80681E0080780E0180705" +
				"3A1020300010F491E010C068E478EE81E090E0A60131" +
				"3A1020400095010E94E01179018A010894E108F108E4" +
				"3A102050000109110993E0A1E05A1631F48091810041" +
				"3A10206000887F982B9093810089819A81AB81BC8174" +
				"3A102070000097A105B10529F48FEF9FEFAFEFBFEFF8" +
				"3A1020800013C0220C331CB10180E090E029813A8119" +
				"3A102090004B815C810E949F1128EE33E040E050E0CC" +
				"3A1020A0000E94BE11C901DA01E1E05E16A1F0F2E082" +
				"3A1020B0005F1619F1552099F5E7BC80932903909399" +
				"3A1020C0002A03A0932B03B0932C0380916E008260AF" +
				"3A1020D00080936E0024C0F0928900E0928800809383" +
				"3A1020E000300390933103A0933203B0933303809174" +
				"3A1020F0006F00826080936F0012C0E092B300809303" +
				"3A10210000370390933803A0933903B0933A03809137" +
				"3A10211000700082608093700002C084E06CCF0F90EA" +
				"3A102120000F900F900F90CF91DF911F910F91FF9023" +
				"3A10213000EF90DF90CF90BF90AF909F908F907F9067" +
				"3A102140006F905F903F902F900895FC019B018481D8" +
				"3A1021500095816817790728F460817181611571058F" +
				"3A1021600029F410923E036EE373E002C0620F731F06" +
				"3A10217000CB0108950F931F93CF93DF93EC018B0155" +
				"3A102180006F5F7F4F888199810E949101009711F4C0" +
				"3A1021900080E005C0998388831B830A8381E0DF91F7" +
				"3A1021A000CF911F910F910895CF93DF93EC01888118" +
				"3A1021B0009981892B29F08A819B818617970760F482" +
				"3A1021C000CE010E94BA10882341F08C819D81892B19" +
				"3A1021D00019F4E881F981108281E0DF91CF910895AF" +
				"3A1021E000EF92FF920F931F93CF93DF93EC017B014C" +
				"3A1021F0006C817D81E114F104C1F04115510599F024" +
				"3A102200008A01060F171FB8010E94D410882369F0B5" +
				"3A10221000888199812C813D81820F931FB7010E9493" +
				"3A102220006F021D830C8381E001C080E0DF91CF91BC" +
				"3A102230001F910F91FF90EF9008956115710511F4B2" +
				"3A1022400080E00895DB010D900020E9F71197A61BAF" +
				"3A10225000B70BAD010E94F0100895FB016081718100" +
				"3A10226000448155810E94F0100895CF93DF93EC01D3" +
				"3A1022700088819981009711F00E9439011982188292" +
				"3A102280001D821C821B821A82DF91CF910895EF92EA" +
				"3A10229000FF920F931F93CF93DF93EC017B018A0191" +
				"3A1022A000BA010E94D410882321F4CE010E94351176" +
				"3A1022B00007C01D830C8388819981B7010E946F023A" +
				"3A1022C000CE01DF91CF911F910F91FF90EF90089574" +
				"3A1022D000CF93DF93EC01198218821B821A821D8230" +
				"3A1022E0001C821E826115710551F0DB010D900020EA" +
				"3A1022F000E9F71197A61BB70BAD010E944711DF91BB" +
				"3A10230000CF910895CF93DF93EC01FB0186179707D8" +
				"3A1023100061F0608171816115710529F044815581F9" +
				"3A102320000E94471102C00E943511CE01DF91CF916A" +
				"3A102330000895FC01808191810E9439010895629F76" +
				"3A10234000D001739FF001829FE00DF11D649FE00DAD" +
				"3A10235000F11D929FF00D839FF00D749FF00D659F0E" +
				"3A10236000F00D9927729FB00DE11DF91F639FB00D0D" +
				"3A10237000E11DF91FBD01CF0111240895A1E21A2E1C" +
				"3A10238000AA1BBB1BFD010DC0AA1FBB1FEE1FFF1F19" +
				"3A10239000A217B307E407F50720F0A21BB30BE40B69" +
				"3A1023A000F50B661F771F881F991F1A9469F76095B0" +
				"3A1023B0007095809590959B01AC01BD01CF0108956A" +
				"3A1023C00097FB092E05260ED057FD04D0D7DF0AD083" +
				"3A1023D000001C38F450954095309521953F4F4F4F54" +
				"3A1023E0005F4F0895F6F790958095709561957F4FB2" +
				"3A1023F0008F4F9F4F0895EE0FFF1F0590F491E02D32" +
				"3A1024000009942F923F924F925F926F927F928F9298" +
				"3A102410009F92AF92BF92CF92DF92EF92FF920F9373" +
				"3A102420001F93CF93DF93CDB7DEB7CA1BDB0B0FB67D" +
				"3A10243000F894DEBF0FBECDBF09942A88398848883A" +
				"3A102440005F846E847D848C849B84AA84B984C884D0" +
				"3A10245000DF80EE80FD800C811B81AA81B981CE0FC7" +
				"3A10246000D11D0FB6F894DEBF0FBECDBFED010895AC" +
				"3A1024700010E0C8ECD0E004C0FE010E94FD112296DD" +
				"3A0A248000CA3CD107C9F7F894FFCF5A" +
				"3A10248A00754353530076302E316100444154410064" +
				"3A10249A0000524553455400535045414B4552003371" +
				"3A1024AA00004C43445F53435245454E00694A6163B9" +
				"3A1024BA006B657420436C6F6E65005363616E2051C7" +
				"3A1024CA005220746167004C45445F4C414D500032C4" +
				"3A1024DA002C313300687474703A2F2F666F6C6B2E30" +
				"3A1024EA006E746E752E6E6F2F737661727661612FC0" +
				"3A1024FA007574696C732F70726F327777772F2361D7" +
				"3A10250A007070496431004F534E4150204A61636BE9" +
				"3A10251A0065740024242400552C002C4E00007B22D4" +
				"3A10252A006E616D65223A2200222C00227665727352" +
				"3A10253A00696F6E223A220022736572766963657347" +
				"3A10254A00223A205B005D2C00226C696E6B73223A82" +
				"3A10255A00205B005D7D002C2000222C20226C696EFD" +
				"3A10256A006B223A2200227D007B20226964223A20D3" +
				"3A10257A002200222C202270696E7322203A22002027" +
				"3A10258A000043030000FF000000006F08AA0D0000CE" +
				"3A10259A0040001400540000000000050DAA0D9B0C19" +
				"3A0625AA00CC0CAC0CF50C9A" +
				"3A00000001FF";

		//Convert string to byte array
		byte[] binaryFile = new byte[hexData.length() / 2];
		for(int i=0; i < hexData.length(); i+=2)
		{
			binaryFile[i/2] = Integer.decode("0x" + hexData.substring(i, i + 2)).byteValue();
		}
		return binaryFile;
	}

	/**	method for handling the click of the install button */
	public void installClicked(View view){

		//Creates an alertdialog builder
		AlertDialog.Builder builder = new AlertDialog.Builder(this);

		if(!Devices.isConnected()){
			//If no device connected, create popup with that message
			builder.setMessage("Cannot install app, no device connected").setPositiveButton("Cancel",new DialogInterface.OnClickListener() {

				@Override
				public void onClick(DialogInterface dialog, int which) {

				}

			}).setNegativeButton("Choose a device",new DialogInterface.OnClickListener(){
				@Override
				public void onClick(DialogInterface dialog, int which){
					startActivity(new Intent(ctxt, Devices.class));
				}
			});
		}
		else{
			builder.setMessage("Press install to install this app to " + getDeviceName() + ".\n\n"+
					"Do not turn off Bluetooth or move away from the device.")
					.setPositiveButton("Install", new DialogInterface.OnClickListener(){

						@Override
						public void onClick(DialogInterface dialog, int which){

							service = BtArduinoService.getBtService();

							if (service != null) {
								Log.d(TAG, "Fetched service! Progress: " + service.getProgress());

								installDialog.dismiss();

								progressHandler = new Handler();
								progressbarThread = new Thread(new ProgressBarUpdate());
								progressBar.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
								progressBar.setCancelable(false);
								progressBar.setTitle("Installing app to " + getDeviceName());
								progressBar.setMessage("First message.");
								progressBar.setProgress(0);
								progressBar.setMax(100);

								setProgressBarVisibility(true);

								progressBar.show();

								Log.d(TAG, "Ready to start progressBar");
								installingDialog();

								//TODO: add call to the service for it to start the 
								//programmer here.


							}
							else {
								Log.d(TAG, "Service was null!");
							}
						}

					}).setNegativeButton("Cancel", new DialogInterface.OnClickListener(){
						@Override
						public void onClick(DialogInterface dialog, int which){

						}
					}).show();
		}
		installDialog = builder.create();
		//		installDialog.show();
	}

	/**
	 * Method for showing the result of a programming attempt. Writes success
	 * message if it was successful or error message if not.
	 * 
	 * @param error Boolean for indicating if an error message or success message
	 * should be printed. True for error, false for success. 
	 */

	/**
	 * Dialog for displaying progressbar for installation purposes.
	 */
	public void installingDialog(){

		//		progressHandler = new Handler();
		//		progressbarThread = new Thread(new ProgressBarUpdate());
		//		progressBar = new ProgressDialog(this);
		//		progressBar.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
		//		progressBar.setCancelable(false);
		//		progressBar.setTitle("Installing app to " + getDeviceName());
		//		progressBar.setMessage("First message.");
		//		progressBar.setProgress(0);
		//		progressBar.setMax(100);
		//		
		//		setProgressBarVisibility(true);
		//		
		//		progressBar.show();
		//		
		//		Log.d(TAG, "Ready to start progressBar");
		progressbarThread.start();

	}



	private String getDeviceName() {
		if(Devices.isConnected()){
			SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(getBaseContext());
			return pref.getString("connected_device_name", "null");
		}
		return "no device";
	}

	class ShowInformationBox implements Runnable {

		boolean error = false;

		public ShowInformationBox (boolean error) {
			this.error = error;
		}

		@Override
		public void run() {
			//Creates an alertdialog builder
//			AlertDialog.Builder builder = new AlertDialog.Builder(getApplicationContext());

			if (error) {
				//TODO: give better error message?
				responseDialog.setMessage("An error was encountered while trying to program your " +
						"device. Please try to install again.").setPositiveButton
						("OK", new DialogInterface.OnClickListener() {

							@Override
							public void onClick(DialogInterface dialog, int which) {
								//								resultDialog.dismiss();
							}
						});
			}
			else {
				responseDialog.setMessage("You have successfully programmed your device!").setPositiveButton
				("OK", new DialogInterface.OnClickListener() {

					@Override
					public void onClick(DialogInterface dialog, int which) {
						//						resultDialog.dismiss();
					}
				});
			}
			responseDialog.create();
			responseDialog.show();
		}

	}
	public Dialog createDialog(boolean error) {
//		AlertDialog.Builder responseDialog = new AlertDialog.Builder(this);

		if (error) {
		responseDialog.setMessage("Error encountered")
		.setPositiveButton("Ok", new DialogInterface.OnClickListener() {

			@Override
			public void onClick(DialogInterface dialog, int which) {
				//Nothing needs to be done, this closes the box
			}
		}).setCancelable(false);
		}
		
		return responseDialog.show();
	}

	class ProgressBarUpdate implements Runnable {

		@Override
		public void run() {
			Log.d(TAG, "Sending data to service");
			service.sendData(byteArray);
			Log.d(TAG, "Progress has entered run()");

			while (!service.isProgrammerRunning()){
				//				Log.d(TAG, "Programmer not running. Waiting");
			}

			//This should run until the programmer has stopped
			while (true) {
				//				Log.d(TAG, "Programmer is running");
				//Fetch the current message from the service
				message = service.getStateMessage();
				//Get the state of the programmer
				state = service.getProtocolState();

				//The actual progress should only be shown if the programmer is reading or writing
				if (state == ProtocolState.READING || state == ProtocolState.WRITING) {

					//Show the progress
					progressNumber = service.getProgress();
					new Thread(new Runnable() {
						@Override
						public void run() {
							while (progressNumber <= 100){
								progressNumber = service.getProgress();

								//Get the current state to check if it has changed
								progressHandler.post(new Runnable() {

									@Override
									public void run() {
										progressBar.setProgress(progressNumber);
										progressBar.setMessage(message);
									}
								});

								state = service.getProtocolState();
								/*
								 * If the state is not reading or writing, the programmer
								 * has either encountered an error or it is finished. 
								 */
								if (state != ProtocolState.READING && state != ProtocolState.WRITING) {
									break;
								}
							}
						}
					}).start();
				}

				//If an error was encountered
				else if (state == ProtocolState.ERROR_CONNECT || state == ProtocolState.ERROR_PARSE_HEX
						|| state == ProtocolState.ERROR_READ || state == ProtocolState.ERROR_WRITE) {

					Log.d(TAG, "Error received.");
					progressHandler.post(new Runnable() {

						@Override
						public void run() {
							progressBar.setMessage(message);
						}
					});

					//Make the thread sleep for a short interval to show the message
					try { Thread.sleep(1500);
					} catch (Exception e) {}

					progressBar.dismiss();
					//Show the information box
					runOnUiThread(new ShowInformationBox(true));
//					createDialog(true);
					break;
				}

				else if (state == ProtocolState.FINISHED) {

					progressHandler.post(new Runnable() {

						@Override
						public void run() {
							progressBar.setMessage(message);
						}
					});

					progressBar.dismiss();
					//Make the thread sleep for a short interval to show the message
					//					try { Thread.sleep(1500);
					//					} catch (Exception e) {}

					//					informationBox(false);
					break;
				}

				else {
					//					Log.d(TAG, "State: " + state);
					progressHandler.post(new Runnable() {
						//TODO: Add check for failed to program

						@Override
						public void run() {
							progressBar.setMessage(message);
						}
					});
				}

			}
		}

	}
}
